<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seu Ciclo, Seu Poder</title>
    <!-- Importando o Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Importando a fonte Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Importando a biblioteca Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Aplicando a fonte Inter como padr√£o */
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Estilo para a transi√ß√£o suave do conte√∫do do acorde√£o */
        .module-content {
            transition: max-height 0.3s ease-out, padding 0.3s ease-out;
            max-height: 0;
            overflow: hidden;
            padding-top: 0;
            padding-bottom: 0;
        }

        .module-content:not(.hidden) {
            max-height: 2000px;
            /* Um valor alto para permitir expans√£o */
            padding-top: 1.5rem;
            /* 24px */
            padding-bottom: 1.5rem;
            /* 24px */
        }

        /* Estilo para o Overlay de Carregamento */
        #loading-overlay {
            transition: opacity 0.3s ease;
        }
    </style>
</head>

<body class="bg-violet-50 text-gray-700 pb-24"> <!-- Padding-bottom para n√£o cobrir o conte√∫do -->

    <!-- Overlay de Carregamento -->
    <div id="loading-overlay" class="fixed inset-0 bg-violet-50 z-[100] flex flex-col items-center justify-center">
        <!-- √çcone Lucide Spinner Animado -->
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
            class="lucide lucide-loader-circle animate-spin text-violet-600">
            <path d="M21 12a9 9 0 1 1-6.219-8.56" />
        </svg>
        <p class="text-violet-700 font-semibold mt-4">Carregando seus dados...</p>
    </div>

    <!-- Container Principal (agora guarda as "p√°ginas") -->
    <div class="max-w-3xl mx-auto p-4 sm:p-8">

        <!-- ======================= -->
        <!-- P√ÅGINA: IN√çCIO (default) -->
        <!-- ======================= -->
        <div id="page-inicio" class="page-content">
            <!-- Cabe√ßalho -->
            <header class="text-center mb-10">
                <h1 class="text-4xl sm:text-5xl font-bold text-violet-700 mb-4">Seu Ciclo, Seu Poder</h1>
                <p class="text-lg text-gray-600">Um guia amig√°vel para entender tudo sobre a sua primeira menstrua√ß√£o e
                    seu corpo.</p>
            </header>

            <main>
                <!-- Diagrama do Ciclo (Baseado na Imagem) -->
                <section class="mb-12">
                    <div class="relative w-64 h-64 sm:w-72 sm:h-72 mx-auto">
                        <!-- Quadrantes Coloridos -->
                        <div
                            class="absolute top-0 left-0 w-1/2 h-1/2 bg-rose-300 rounded-tl-full flex items-start justify-start p-6 sm:p-8">
                            <span class="font-bold text-rose-800 text-sm sm:text-base">Menstrua√ß√£o</span>
                        </div>
                        <div
                            class="absolute top-0 right-0 w-1/2 h-1/2 bg-emerald-300 rounded-tr-full flex items-start justify-end p-6 sm:p-8 text-right">
                            <span class="font-bold text-emerald-800 text-sm sm:text-base">Ovula√ß√£o</span>
                        </div>
                        <div
                            class="absolute bottom-0 left-0 w-1/2 h-1/2 bg-violet-300 rounded-bl-full flex items-end justify-start p-6 sm:p-8">
                            <span class="font-bold text-violet-800 text-sm sm:text-base">Folicular</span>
                        </div>
                        <div
                            class="absolute bottom-0 right-0 w-1/2 h-1/2 bg-sky-300 rounded-br-full flex items-end justify-end p-6 sm:p-8 text-right">
                            <span class="font-bold text-sky-800 text-sm sm:text-base">L√∫tea</span>
                        </div>

                        <!-- C√≠rculo Central -->
                        <div
                            class="absolute top-1/2 left-1/2 w-28 h-28 sm:w-32 sm:h-32 bg-white rounded-full transform -translate-x-1/2 -translate-y-1/2 flex items-center justify-center shadow-lg">
                            <span class="text-5xl">ü©∏</span>
                        </div>
                    </div>
                </section>

                <!-- Wrapper dos M√≥dulos Acorde√£o -->
                <div class="space-y-6">

                    <!-- M√ìDULO 1: O CICLO SEM MIST√âRIO -->
                    <div class="shadow-lg rounded-2xl">
                        <!-- Cabe√ßalho Clic√°vel -->
                        <button
                            class="module-toggle w-full bg-white p-5 sm:p-6 rounded-2xl flex justify-between items-center cursor-pointer"
                            aria-expanded="false" aria-controls="content-modulo-1" role="button">
                            <div class="flex items-center text-left">
                                <span class="text-3xl mr-4">ü©∏</span>
                                <div>
                                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800">M√ìDULO 1: O CICLO SEM
                                        MIST√âRIO</h2>
                                    <p class="text-sm sm:text-base text-gray-600">Dura√ß√£o Normal: 21-35 dias.</p>
                                </div>
                            </div>
                            <span class="toggle-icon text-3xl font-bold text-violet-600">Ôºã</span>
                        </button>
                        <!-- Conte√∫do Oculto -->
                        <div id="content-modulo-1"
                            class="module-content hidden bg-white rounded-b-2xl border-t border-gray-100 px-5 sm:px-6">
                            <!-- Card: O que √© o Ciclo? -->
                            <div class="bg-violet-50 p-6 rounded-2xl shadow-inner mb-6">
                                <h3 class="text-xl font-bold text-violet-600 mb-3">O que √© o Ciclo?</h3>
                                <p class="leading-relaxed">O ciclo menstrual come√ßa no primeiro dia da sua menstrua√ß√£o e
                                    vai at√© o dia anterior √† pr√≥xima. Seu corpo se prepara para uma poss√≠vel gravidez a
                                    cada m√™s. Se ela n√£o acontece, ele 'limpa a casa' e o sangramento vem.</p>
                                <p class="font-semibold text-gray-800 mt-3">Dura√ß√£o Normal: 21 a 35 dias.</p>
                            </div>
                            <!-- Grid Fases do Ciclo -->
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                <div class="bg-gray-50 p-6 rounded-2xl shadow-inner">
                                    <h3 class="text-xl font-bold text-rose-600 mb-3">Menstrua√ß√£o</h3>
                                    <p class="leading-relaxed">√â a descama√ß√£o da camada interna do seu √∫tero
                                        (endom√©trio).<br><strong>Dica:</strong> N√£o √© sangue 'sujo'! √â apenas um tecido
                                        que seu corpo n√£o precisava mais. A dura√ß√£o costuma ser de 3 a 7 dias.</p>
                                </div>
                                <div class="bg-gray-50 p-6 rounded-2xl shadow-inner">
                                    <h3 class="text-xl font-bold text-violet-600 mb-3">Folicular (Pr√©-Ovula√ß√£o)</h3>
                                    <p class="leading-relaxed">Seu corpo est√° produzindo estrog√™nio e preparando um
                                        √≥vulo. Muitas vezes voc√™ se sente com mais energia, disposta e com mais foco.
                                    </p>
                                </div>
                                <div class="bg-gray-50 p-6 rounded-2xl shadow-inner">
                                    <h3 class="text-xl font-bold text-emerald-600 mb-3">Ovula√ß√£o</h3>
                                    <p class="leading-relaxed">O √≥vulo √© liberado. √â o "√°pice" do seu ciclo, e voc√™ pode
                                        notar um muco vaginal mais transparente e el√°stico neste per√≠odo.</p>
                                </div>
                                <div class="bg-gray-50 p-6 rounded-2xl shadow-inner">
                                    <h3 class="text-xl font-bold text-sky-600 mb-3">L√∫tea (Pr√©-Menstrual)</h3>
                                    <p class="leading-relaxed">O horm√¥nio progesterona domina aqui. √â normal sentir mais
                                        sono, incha√ßo e algumas mudan√ßas de humor (TPM). Seu corpo est√° guardando
                                        energia.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SINAIS DE ALERTA -->
                    <div class="shadow-lg rounded-2xl">
                        <!-- Cabe√ßalho Clic√°vel -->
                        <button
                            class="module-toggle w-full bg-orange-100 p-5 sm:p-6 rounded-2xl flex justify-between items-center cursor-pointer"
                            aria-expanded="false" aria-controls="content-alerta" role="button">
                            <div class="flex items-center text-left">
                                <span class="text-3xl mr-4">üö®</span>
                                <div>
                                    <h2 class="text-xl sm:text-2xl font-bold text-orange-700">Sinais de Alerta</h2>
                                    <p class="text-sm sm:text-base text-orange-600">Quando procurar o Enfermeiro?</p>
                                </div>
                            </div>
                            <span class="toggle-icon text-3xl font-bold text-orange-700">Ôºã</span>
                        </button>
                        <!-- Conte√∫do Oculto -->
                        <div id="content-alerta"
                            class="module-content hidden bg-orange-50 rounded-b-2xl border-t border-orange-200 px-5 sm:px-6">
                            <ul class="list-none space-y-3 text-orange-800">
                                <li class="flex items-start">
                                    <span class="font-bold text-xl mr-3">‚Ä∫</span>
                                    <div><strong>Fluxo Muito Forte:</strong> Precisa trocar absorvente de hora em hora
                                        por mais de 4 horas seguidas.</div>
                                </li>
                                <li class="flex items-start">
                                    <span class="font-bold text-xl mr-3">‚Ä∫</span>
                                    <div><strong>Dor Incapacitante:</strong> C√≥lica que n√£o passa com rem√©dio ou te
                                        impede de ir √† aula/trabalho, ou que te faz vomitar.</div>
                                </li>
                                <li class="flex items-start">
                                    <span class="font-bold text-xl mr-3">‚Ä∫</span>
                                    <div><strong>Ciclos Extremos:</strong> Ciclo com menos de 21 dias ou mais de 35
                                        dias, de forma persistente.</div>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <!-- M√ìDULO 2: BEM-ESTAR E EMO√á√ïES -->
                    <div class="shadow-lg rounded-2xl">
                        <!-- Cabe√ßalho Clic√°vel -->
                        <button
                            class="module-toggle w-full bg-white p-5 sm:p-6 rounded-2xl flex justify-between items-center cursor-pointer"
                            aria-expanded="false" aria-controls="content-modulo-2" role="button">
                            <div class="flex items-center text-left">
                                <span class="text-3xl mr-4">üí™</span>
                                <div>
                                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800">M√ìDULO 2: BEM-ESTAR E
                                        EMO√á√ïES</h2>
                                    <p class="text-sm sm:text-base text-gray-600">Lidando com c√≥licas, TPM e nutri√ß√£o.
                                    </p>
                                </div>
                            </div>
                            <span class="toggle-icon text-3xl font-bold text-violet-600">Ôºã</span>
                        </button>
                        <!-- Conte√∫do Oculto -->
                        <div id="content-modulo-2"
                            class="module-content hidden bg-white rounded-b-2xl border-t border-gray-100 px-5 sm:px-6">
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                <!-- Card: C√≥licas -->
                                <div class="bg-gray-50 p-6 rounded-2xl shadow-inner">
                                    <h3 class="text-xl font-bold text-violet-600 mb-3">C√≥licas: O Que Alivia?</h3>
                                    <ul class="list-none space-y-4">
                                        <li class="flex items-start">
                                            <span class="text-2xl mr-3">üî•</span>
                                            <div><strong>Calor:</strong> Use bolsa de √°gua quente na barriga/costas.
                                                Ajuda a relaxar os m√∫sculos do √∫tero.</div>
                                        </li>
                                        <li class="flex items-start">
                                            <span class="text-2xl mr-3">üíä</span>
                                            <div><strong>Rem√©dio:</strong> Tome o analg√©sico no in√≠cio do inc√¥modo.
                                                Converse com o enfermeiro sobre qual √© o mais indicado.</div>
                                        </li>
                                        <li class="flex items-start">
                                            <span class="text-2xl mr-3">üßò‚Äç‚ôÄÔ∏è</span>
                                            <div><strong>Movimento:</strong> Alongamentos suaves e caminhadas leves
                                                podem ajudar a relaxar.</div>
                                        </li>
                                    </ul>
                                </div>
                                <!-- Card: TPM vs. TDPM -->
                                <div class="bg-gray-50 p-6 rounded-2xl shadow-inner">
                                    <h3 class="text-xl font-bold text-violet-600 mb-3">TPM vs. TDPM</h3>
                                    <p class="leading-relaxed">√â normal sentir-se diferente (irritada, cansada) antes da
                                        menstrua√ß√£o. Se as emo√ß√µes ou a ansiedade forem t√£o fortes que atrapalham seus
                                        estudos ou sua vida social, chame isso de TDPM. Nesses casos, converse com o
                                        enfermeiro ou um psic√≥logo.</p>
                                </div>
                            </div>
                            <!-- Card: Nutri√ß√£o -->
                            <div class="bg-gray-50 p-6 rounded-2xl shadow-inner mt-6">
                                <h3 class="text-xl font-bold text-violet-600 mb-3">Nutri√ß√£o e Seu Humor</h3>
                                <ul class="list-none space-y-4">
                                    <li class="flex items-start">
                                        <span class="text-2xl mr-3">üíß</span>
                                        <div><strong>Beba √Ågua:</strong> Ajuda a reduzir o incha√ßo e a reten√ß√£o de
                                            l√≠quido da fase pr√©-menstrual.</div>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="text-2xl mr-3">ü•¶</span>
                                        <div><strong>Coma Ferro:</strong> Durante o fluxo, alimentos ricos em ferro
                                            (carne, legumes escuros) ajudam a repor o que foi perdido e evitam a
                                            fraqueza.</div>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="text-2xl mr-3">üßÇ</span>
                                        <div><strong>Reduza o Sal:</strong> Menos sal ajuda a reduzir o incha√ßo.</div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- M√ìDULO 3: CUIDADOS PR√ÅTICOS E HIGIENE -->
                    <div class="shadow-lg rounded-2xl">
                        <!-- Cabe√ßalho Clic√°vel -->
                        <button
                            class="module-toggle w-full bg-white p-5 sm:p-6 rounded-2xl flex justify-between items-center cursor-pointer"
                            aria-expanded="false" aria-controls="content-modulo-3" role="button">
                            <div class="flex items-center text-left">
                                <span class="text-3xl mr-4">üß∫</span>
                                <div>
                                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800">M√ìDULO 3: CUIDADOS E HIGIENE
                                    </h2>
                                    <p class="text-sm sm:text-base text-gray-600">Higiene √≠ntima correta e trocas.</p>
                                </div>
                            </div>
                            <span class="toggle-icon text-3xl font-bold text-violet-600">Ôºã</span>
                        </button>
                        <!-- Conte√∫do Oculto -->
                        <div id="content-modulo-3"
                            class="module-content hidden bg-white rounded-b-2xl border-t border-gray-100 px-5 sm:px-6">
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                <div class="bg-gray-50 p-6 rounded-2xl shadow-inner">
                                    <h3 class="text-xl font-bold text-violet-600 mb-3">Higiene √çntima Correta</h3>
                                    <ul class="list-none space-y-4">
                                        <li class="flex items-start">
                                            <span class="text-2xl mr-3">üßº</span>
                                            <div><strong>Como lavar:</strong> Sempre de frente para tr√°s. Use √°gua e
                                                sab√£o neutro (ou sabonete √≠ntimo) somente na parte externa.</div>
                                        </li>
                                        <li class="flex items-start">
                                            <span class="text-2xl mr-3">üö´</span>
                                            <div><strong>O qu√™ evitar:</strong> Nunca lave o canal vaginal por dentro
                                                (ele se limpa sozinho!).</div>
                                        </li>
                                    </ul>
                                </div>
                                <div class="bg-gray-50 p-6 rounded-2xl shadow-inner">
                                    <h3 class="text-xl font-bold text-violet-600 mb-3">Frequ√™ncia de Troca</h3>
                                    <p class="leading-relaxed"><strong>Regra de Ouro:</strong> Trocar absorvente
                                        (externo) a cada 3 a 4 horas, mesmo com pouco fluxo. Trocar a tempo evita odores
                                        e ajuda a manter a pele saud√°vel.</p>
                                </div>
                                <div class="bg-gray-50 p-6 rounded-2xl shadow-inner">
                                    <h3 class="text-xl font-bold text-violet-600 mb-3">EcoAbsorvente de Pano</h3>
                                    <p class="leading-relaxed mb-3"><strong>Vantagens:</strong> Sustent√°vel, econ√¥mico a
                                        longo prazo e muito confort√°vel.</p>
                                    <p class="leading-relaxed"><strong>Aten√ß√£o:</strong> A lavagem correta √© crucial
                                        para a sua sa√∫de! Lave-o √† m√£o ap√≥s o uso, seque-o totalmente ao sol e guarde-o
                                        em um local arejado.</p>
                                </div>
                                <div class="bg-gray-50 p-6 rounded-2xl shadow-inner">
                                    <h3 class="text-xl font-bold text-violet-600 mb-3">Descarte Consciente</h3>
                                    <ul class="list-none space-y-4">
                                        <li class="flex items-start">
                                            <span class="text-2xl mr-3">üóëÔ∏è</span>
                                            <div><strong>Onde Jogar:</strong> No lixo comum. Sempre embrulhe o produto
                                                usado em papel higi√™nico ou na embalagem original antes de descartar.
                                            </div>
                                        </li>
                                        <li class="flex items-start">
                                            <span class="text-2xl mr-3">üö´</span>
                                            <div><strong>Nunca</strong> jogue absorvente, papel higi√™nico ou outros
                                                produtos no vaso sanit√°rio.</div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- M√ìDULO 4: SEXUALIDADE E PREVEN√á√ÉO -->
                    <div class="shadow-lg rounded-2xl">
                        <!-- Cabe√ßalho Clic√°vel -->
                        <button
                            class="module-toggle w-full bg-white p-5 sm:p-6 rounded-2xl flex justify-between items-center cursor-pointer"
                            aria-expanded="false" aria-controls="content-modulo-4" role="button">
                            <div class="flex items-center text-left">
                                <span class="text-3xl mr-4">üíò</span>
                                <div>
                                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800">M√ìDULO 4: SEXUALIDADE E
                                        PREVEN√á√ÉO</h2>
                                    <p class="text-sm sm:text-base text-gray-600">O Ciclo N√£o √© Contraceptivo! (Alerta)
                                    </p>
                                </div>
                            </div>
                            <span class="toggle-icon text-3xl font-bold text-violet-600">Ôºã</span>
                        </button>
                        <!-- Conte√∫do Oculto -->
                        <div id="content-modulo-4"
                            class="module-content hidden bg-white rounded-b-2xl border-t border-gray-100 px-5 sm:px-6">
                            <!-- Card: Alerta -->
                            <div class="bg-rose-100 border-l-4 border-rose-500 p-6 rounded-lg shadow-lg mb-6">
                                <h3 class="text-xl font-bold text-rose-700 mb-3">O Ciclo N√£o √© Contraceptivo! (Alerta)
                                </h3>
                                <p class="leading-relaxed mb-2"><strong>Mito:</strong> O ciclo menstrual regular √©
                                    confi√°vel para evitar gravidez.</p>
                                <p class="leading-relaxed"><strong>Verdade:</strong> O corpo adolescente √© irregular!
                                    N√£o use o app como um calend√°rio contraceptivo. A √∫nica forma segura de evitar
                                    gravidez √© o uso consistente de m√©todos.</p>
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                <div class="bg-gray-50 p-6 rounded-2xl shadow-inner">
                                    <h3 class="text-xl font-bold text-violet-600 mb-3">Preven√ß√£o de ISTs/Aids</h3>
                                    <p class="leading-relaxed">A camisinha (masculina ou feminina) √© o √∫nico m√©todo que
                                        evita as Infec√ß√µes Sexualmente Transmiss√≠veis (ISTs) e ainda ajuda a evitar
                                        gravidez. Voc√™ pode conseguir camisinhas de gra√ßa na enfermaria da escola ou no
                                        posto de sa√∫de.</p>
                                </div>
                                <div class="bg-gray-50 p-6 rounded-2xl shadow-inner">
                                    <h3 class="text-xl font-bold text-violet-600 mb-3">M√©todos Contraceptivos</h3>
                                    <p class="leading-relaxed">Se voc√™ est√° pensando em usar um m√©todo (p√≠lula,
                                        injet√°vel, implante), venha conversar! O enfermeiro pode te dar o primeiro
                                        aconselhamento e te encaminhar para o servi√ßo de sa√∫de. Sua escolha √© importante
                                        e precisa de acompanhamento profissional.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- M√ìDULO 5: ONDE BUSCAR AJUDA -->
                    <div class="shadow-lg rounded-2xl">
                        <!-- Cabe√ßalho Clic√°vel -->
                        <button
                            class="module-toggle w-full bg-white p-5 sm:p-6 rounded-2xl flex justify-between items-center cursor-pointer"
                            aria-expanded="false" aria-controls="content-modulo-5" role="button">
                            <div class="flex items-center text-left">
                                <span class="text-3xl mr-4">‚úÖ</span>
                                <div>
                                    <h2 class="text-xl sm:text-2xl font-bold text-gray-800">M√ìDULO 5: ONDE BUSCAR AJUDA
                                    </h2>
                                    <p class="text-sm sm:text-base text-gray-600">Seu Enfermeiro(a) Escolar e mais.</p>
                                </div>
                            </div>
                            <span class="toggle-icon text-3xl font-bold text-violet-600">Ôºã</span>
                        </button>
                        <!-- Conte√∫do Oculto -->
                        <div id="content-modulo-5"
                            class="module-content hidden bg-white rounded-b-2xl border-t border-gray-100 px-5 sm:px-6">
                            <div class="bg-emerald-100 border-l-4 border-emerald-500 p-6 rounded-lg shadow-lg">
                                <h3 class="text-xl font-bold text-emerald-700 mb-4">N√£o Est√° Sozinha! Onde Buscar Ajuda?
                                </h3>
                                <ul class="list-none space-y-4">
                                    <li class="flex items-start">
                                        <span class="text-2xl mr-3">üë©‚Äç‚öïÔ∏è</span>
                                        <div><strong>Seu Enfermeiro(a) Escolar:</strong> Para perguntas sobre seu ciclo,
                                            c√≥licas, m√©todos contraceptivos, e aconselhamento sobre ISTs. Ele/ela √© o
                                            seu primeiro ponto de apoio e pode te orientar.</div>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="text-2xl mr-3">üè•</span>
                                        <div><strong>Posto de Sa√∫de/UBS:</strong> Local de acesso gratuito a camisinhas,
                                            testes r√°pidos, p√≠lula do dia seguinte (se necess√°rio) e para iniciar o uso
                                            de m√©todos contraceptivos com acompanhamento m√©dico.</div>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="text-2xl mr-3">üí¨</span>
                                        <div><strong>Psic√≥logo(a):</strong> Para suporte emocional, lidar com estresse,
                                            ansiedade e em casos de TDPM (Transtorno Disf√≥rico Pr√©-Menstrual) ou
                                            quest√µes sobre sexualidade e relacionamentos.</div>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                </div> <!-- Fim do Wrapper dos M√≥dulos -->
            </main>

            <!-- Rodap√© da P√°gina In√≠cio -->
            <footer class="text-center mt-12 py-6 border-t border-violet-200">
                <p class="text-gray-600">Um projeto feito com carinho para voc√™. ‚ù§Ô∏è</p>
            </footer>
        </div>

        <!-- ========================== -->
        <!-- P√ÅGINA: CALEND√ÅRIO (Oculta) -->
        <!-- ========================== -->
        <div id="page-calendario" class="page-content hidden">
            <header class="text-center mb-10">
                <h1 class="text-4xl sm:text-5xl font-bold text-violet-700 mb-4">Calend√°rio do Ciclo</h1>
                <p class="text-lg text-gray-600">Marque os dias da sua menstrua√ß√£o para acompanhar seu ciclo.</p>
            </header>

            <main>
                <div id="calendar-container" class="bg-white p-4 sm:p-6 rounded-2xl shadow-lg">
                    <!-- Cabe√ßalho do Calend√°rio (M√™s/Ano e Bot√µes) -->
                    <div id="calendar-header" class="flex justify-between items-center mb-4">
                        <button id="prev-month" class="p-2 rounded-full hover:bg-violet-100 text-violet-600"
                            aria-label="M√™s anterior">
                            <!-- √çcone Lucide -->
                            <i data-lucide="chevron-left" class="h-6 w-6"></i>
                        </button>
                        <h2 id="month-year" class="text-xl font-bold text-violet-800"></h2>
                        <button id="next-month" class="p-2 rounded-full hover:bg-violet-100 text-violet-600"
                            aria-label="Pr√≥ximo m√™s">
                            <!-- √çcone Lucide -->
                            <i data-lucide="chevron-right" class="h-6 w-6"></i>
                        </button>
                    </div>

                    <!-- Dias da Semana -->
                    <div id="calendar-weekdays"
                        class="grid grid-cols-7 gap-1 sm:gap-2 text-center font-semibold text-gray-500 text-sm mb-2">
                        <div>D</div>
                        <div>S</div>
                        <div>T</div>
                        <div>Q</div>
                        <div>Q</div>
                        <div>S</div>
                        <div>S</div>
                    </div>

                    <!-- Grid dos Dias -->
                    <div id="calendar-grid" class="grid grid-cols-7 gap-1 sm:gap-2">
                        <!-- Dias ser√£o gerados pelo JS -->
                    </div>

                    <!-- Legenda -->
                    <div class="mt-6 pt-4 border-t border-gray-100">
                        <h3 class="text-lg font-semibold mb-3 text-gray-700">Legenda:</h3>
                        <div class="space-y-2">
                            <div class="flex items-center">
                                <div class="w-5 h-5 bg-rose-300 rounded-full mr-2 border border-rose-400"></div>
                                <span class="text-gray-600">Dias de Menstrua√ß√£o</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-5 h-5 bg-rose-100 rounded-full mr-2 border border-rose-200"
                                    style="background-image: linear-gradient(135deg, rgba(255,255,255,0.5) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.5) 50%, rgba(255,255,255,0.5) 75%, transparent 75%, transparent); background-size: 8px 8px;">
                                </div>
                                <span class="text-gray-600">Previs√£o de Menstrua√ß√£o</span>
                            </div>
                            <!-- NOVA LEGENDA: Per√≠odo F√©rtil -->
                            <div class="flex items-center">
                                <div class="w-5 h-5 bg-emerald-100 rounded-full mr-2 border border-emerald-200"></div>
                                <span class="text-gray-600">Previs√£o de Per√≠odo F√©rtil</span>
                            </div>
                        </div>
                        <!-- NOVO AVISO -->
                        <p class="text-xs text-gray-500 mt-4 italic">* As previs√µes de per√≠odo f√©rtil e menstrua√ß√£o s√£o
                            apenas <strong class="font-semibold">estimativas</strong> e <strong
                                class="font-semibold">N√ÉO</strong> devem ser usadas como m√©todo contraceptivo.</p>
                    </div>
                </div>
            </main>
        </div>

        <!-- ========================== -->
        <!-- P√ÅGINA: COMUNIDADE (Oculta) -->
        <!-- ========================== -->
        <div id="page-comunidade" class="page-content hidden">
            <header class="text-center mb-10">
                <h1 class="text-4xl sm:text-5xl font-bold text-violet-700 mb-4">Comunidade</h1>
                <p class="text-lg text-gray-600">Um espa√ßo para compartilhar e aprender juntas.</p>
            </header>
            <main class="space-y-8">

                <!-- Caixa de Nova Postagem (Funcional) -->
                <div class="bg-white p-6 rounded-2xl shadow-lg">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                        <i data-lucide="message-square-plus" class="w-6 h-6 mr-3 text-violet-600"></i>
                        Iniciar uma nova conversa
                    </h2>
                    <!-- CAMPO DE T√çTULO -->
                    <input type="text" id="post-title-input"
                        class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-violet-500 mb-4"
                        placeholder="Escreva um t√≠tulo para sua postagem...">
                    <textarea id="post-textarea"
                        class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-violet-500"
                        rows="3" placeholder="Escreva sua d√∫vida an√¥nima ou compartilhe sua experi√™ncia..."></textarea>
                    <button id="post-btn"
                        class="mt-4 w-full bg-violet-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-violet-700 transition-colors duration-200 flex items-center justify-center">
                        <i data-lucide="send" class="w-5 h-5 mr-2"></i>
                        Postar
                    </button>
                    <!-- TEXTO ATUALIZADO (N√ÉO MAIS LOCALSTORAGE) -->
                    <p class="text-xs text-gray-500 mt-2 text-center">Suas postagens s√£o p√∫blicas e vis√≠veis para toda a
                        comunidade.</p>
                </div>

                <!-- Feed de T√≥picos Recentes (Din√¢mico) -->
                <!-- O JS vai popular este container -->
                <div id="community-feed-wrapper" class="space-y-6">
                    <h2 class="text-3xl font-bold text-gray-800">T√≥picos Recentes</h2>
                    <!-- Posts ser√£o gerados por JS -->
                </div>
            </main>
        </div>

        <!-- ================================== -->
        <!-- P√ÅGINA: DETALHE DO POST (Oculta)  -->
        <!-- ================================== -->
        <div id="page-post-detail" class="page-content hidden">
            <header class="mb-8">
                <!-- Bot√£o Voltar -->
                <button data-target="page-comunidade"
                    class="subpage-trigger mb-4 inline-flex items-center text-violet-600 font-semibold hover:text-violet-800 transition-colors">
                    <i data-lucide="chevron-left" class="w-5 h-5 mr-1"></i>
                    Voltar para Comunidade
                </button>
            </header>
            <main class="space-y-8">
                <!-- Container para o Post Original -->
                <div id="post-detail-content" class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg">
                    <!-- Post original ser√° injetado aqui pelo JS -->
                </div>

                <!-- Se√ß√£o de Respostas -->
                <div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Respostas</h2>

                    <!-- Formul√°rio de Nova Resposta -->
                    <div class="bg-white p-6 rounded-2xl shadow-lg mb-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <i data-lucide="message-square-plus" class="w-5 h-5 mr-3 text-violet-600"></i>
                            Deixar uma resposta
                        </h3>
                        <textarea id="reply-textarea"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-violet-500"
                            rows="3" placeholder="Escreva sua resposta..."></textarea>
                        <button id="reply-btn"
                            class="mt-4 w-full bg-violet-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-violet-700 transition-colors duration-200 flex items-center justify-center">
                            <i data-lucide="send" class="w-5 h-5 mr-2"></i>
                            Responder
                        </button>
                    </div>

                    <!-- Lista de Respostas Anteriores -->
                    <div id="post-replies-list" class="space-y-6">
                        <!-- Respostas ser√£o injetadas aqui pelo JS -->
                    </div>
                </div>
            </main>
        </div>


        <!-- ====================== -->
        <!-- P√ÅGINA: PERFIL (Oculta) -->
        <!-- ====================== -->
        <div id="page-perfil" class="page-content hidden">
            <header class="text-center mb-10">
                <h1 class="text-4xl sm:text-5xl font-bold text-violet-700 mb-4">Meu Perfil</h1>
                <p class="text-lg text-gray-600">Ajuste suas informa√ß√µes e prefer√™ncias.</p>
            </header>
            <main class="space-y-8">

                <!-- Card de Informa√ß√µes Pessoais -->
                <div class="bg-white p-6 rounded-2xl shadow-lg flex items-center space-x-4">
                    <div>
                        <!-- √çcone de Perfil Grande -->
                        <i data-lucide="user-circle" class="w-16 h-16 text-violet-500"></i>
                    </div>
                    <div class="flex-1">
                        <label for="nickname" class="text-sm font-medium text-gray-500">Seu apelido:</label>
                        <input type="text" id="nickname" value="Visitante"
                            class="w-full text-2xl font-bold text-gray-800 border-b-2 border-transparent focus:border-violet-500 outline-none transition-colors bg-transparent">
                    </div>
                    <button id="save-nickname-btn" class="p-2 rounded-full hover:bg-violet-100 text-violet-600"
                        aria-label="Salvar apelido">
                        <i data-lucide="save" class="w-5 h-5"></i>
                    </button>
                    <span id="save-nickname-feedback"
                        class="text-sm text-green-600 font-medium opacity-0 transition-opacity duration-300">Salvo!</span>
                </div>

                <!-- Card de Configura√ß√µes do Ciclo -->
                <div class="bg-white p-6 rounded-2xl shadow-lg">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i data-lucide="calendar-days" class="w-6 h-6 mr-3 text-violet-600"></i>
                        Configura√ß√µes do Ciclo
                    </h2>
                    <div class="space-y-6">
                        <!-- Dura√ß√£o M√©dia do Ciclo -->
                        <div>
                            <label for="cycle-length" class="block text-sm font-medium text-gray-700 mb-1">Dura√ß√£o m√©dia
                                do seu ciclo (dias):</label>
                            <p class="text-xs text-gray-500 mb-2">Conte do 1¬∫ dia da menstrua√ß√£o at√© o dia *anterior* √†
                                pr√≥xima. (O app tentar√° calcular a m√©dia sozinho se voc√™ tiver dados salvos).</p>
                            <input type="number" id="cycle-length" value="28"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-violet-500">
                        </div>
                        <!-- Dura√ß√£o M√©dia da Menstrua√ß√£o -->
                        <div>
                            <label for="period-length" class="block text-sm font-medium text-gray-700 mb-1">Dura√ß√£o
                                m√©dia da sua menstrua√ß√£o (dias):</label>
                            <input type="number" id="period-length" value="5"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-violet-500">
                        </div>
                        <div class="flex items-center">
                            <button id="save-config-btn"
                                class="bg-violet-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-violet-700 transition-colors duration-200 flex items-center justify-center">
                                <i data-lucide="save" class="w-5 h-5 mr-2"></i>
                                Salvar Configura√ß√µes do Ciclo
                            </button>
                            <span id="save-config-feedback"
                                class="ml-4 text-sm text-green-600 font-medium opacity-0 transition-opacity duration-300">Salvo!</span>
                        </div>
                        <p id="avg-cycle-feedback" class="text-sm text-gray-600 italic"></p>
                    </div>
                </div>

                <!-- ATUALIZADO: Card de Gerenciamento de Dados (Agora mostra o User ID) -->
                <div class="bg-white p-6 rounded-2xl shadow-lg">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i data-lucide="key-round" class="w-6 h-6 mr-3 text-violet-600"></i>
                        Sua Conta
                    </h2>
                    <p class="text-sm text-gray-600 mb-4">Seus dados (perfil e calend√°rio) est√£o salvos na nuvem de
                        forma an√¥nima.</p>
                    <label for="user-id-display" class="block text-sm font-medium text-gray-700 mb-1">Seu ID de usu√°rio
                        an√¥nimo:</label>
                    <input type="text" id="user-id-display" value="Carregando..." readonly
                        class="w-full p-3 border border-gray-200 rounded-lg bg-gray-50 text-gray-500 text-sm break-words">
                    <p class="text-xs text-gray-500 mt-2">Este ID √© a √∫nica forma de acessar seus dados. Guarde-o se
                        quiser acess√°-lo em outro dispositivo no futuro (funcionalidade de "login com ID" a ser
                        implementada).</p>
                </div>

                <!-- Card de Prefer√™ncias e Outros -->
                <div class="bg-white p-6 rounded-2xl shadow-lg">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i data-lucide="settings-2" class="w-6 h-6 mr-3 text-violet-600"></i>
                        Prefer√™ncias e Outros
                    </h2>
                    <div class="space-y-4">
                        <!-- Notifica√ß√µes (Simulado com Checkbox) -->
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                            <span class="font-medium text-gray-700">Lembretes e Notifica√ß√µes</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" value="" class="sr-only peer" checked>
                                <div
                                    class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-2 peer-focus:ring-violet-300 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-violet-600">
                                </div>
                            </label>
                        </div>

                        <!-- Links Agora s√£o Bot√µes com data-target -->
                        <button data-target="page-privacidade"
                            class="subpage-trigger w-full text-left flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <span class="font-medium text-gray-700">Pol√≠tica de Privacidade</span>
                            <i data-lucide="chevron-right" class="w-5 h-5 text-gray-400"></i>
                        </button>
                        <button data-target="page-termos"
                            class="subpage-trigger w-full text-left flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <span class="font-medium text-gray-700">Termos de Uso</span>
                            <i data-lucide="chevron-right" class="w-5 h-5 text-gray-400"></i>
                        </button>
                        <button data-target="page-ajuda"
                            class="subpage-trigger w-full text-left flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                            <span class="font-medium text-gray-700">Ajuda e Suporte</span>
                            <i data-lucide="chevron-right" class="w-5 h-5 text-gray-400"></i>
                        </button>
                    </div>
                </div>

            </main>
        </div>

        <!-- ============================= -->
        <!-- P√ÅGINA: PRIVACIDADE (Oculta)  -->
        <!-- ============================= -->
        <div id="page-privacidade" class="page-content hidden">
            <header class="mb-8">
                <!-- Bot√£o Voltar -->
                <button data-target="page-perfil"
                    class="subpage-trigger mb-4 inline-flex items-center text-violet-600 font-semibold hover:text-violet-800 transition-colors">
                    <i data-lucide="chevron-left" class="w-5 h-5 mr-1"></i>
                    Voltar ao Perfil
                </button>
                <h1 class="text-4xl sm:text-5xl font-bold text-violet-700 mb-4">Pol√≠tica de Privacidade</h1>
            </header>
            <main class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg space-y-5 text-gray-700 leading-relaxed">
                <p>N√≥s levamos sua privacidade a s√©rio. Este aplicativo foi projetado para ser um espa√ßo seguro para
                    voc√™.</p>

                <h2 class="text-xl font-bold text-gray-800 pt-4">1. Quais dados coletamos?</h2>
                <p>Coletamos as informa√ß√µes que voc√™ insere voluntariamente, que s√£o armazenadas de forma segura nos
                    servidores do Google Firebase:</p>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li>Seu apelido (opcional).</li>
                    <li>As datas do seu ciclo (dias de menstrua√ß√£o).</li>
                    <li>As configura√ß√µes do seu ciclo (dura√ß√£o m√©dia).</li>
                    <li>Posts e respostas na comunidade.</li>
                    <li>Um ID de usu√°rio an√¥nimo para conectar voc√™ aos seus dados.</li>
                </ul>

                <h2 class="text-xl font-bold text-gray-800 pt-4">2. Como usamos seus dados?</h2>
                <p>Os dados s√£o usados para o funcionamento do aplicativo:</p>
                <ul class="list-disc list-inside ml-4 space-y-1">
                    <li><strong class="text-violet-700">Dados Privados:</strong> Seu apelido, datas do ciclo e
                        configura√ß√µes s√£o salvos de forma privada, vinculados apenas ao seu ID an√¥nimo. Ningu√©m mais
                        pode ver esses dados.</li>
                    <li><strong class="text-violet-700">Dados P√∫blicos:</strong> Os posts e respostas que voc√™ cria na
                        Comunidade s√£o p√∫blicos e vis√≠veis para outras usu√°rias do aplicativo. Eles s√£o postados
                        juntamente com o apelido que voc√™ escolheu.</li>
                </ul>


                <h2 class="text-xl font-bold text-gray-800 pt-4">3. Compartilhamento de Dados</h2>
                <p>N√≥s <strong class="text-rose-600">nunca</strong> venderemos ou compartilharemos suas informa√ß√µes
                    <strong class="text-rose-600">privadas</strong> (como seu hist√≥rico de ciclo) com terceiros. Os
                    dados
                    da comunidade s√£o, por natureza, p√∫blicos dentro do app.
                </p>

                <h2 class="text-xl font-bold text-gray-800 pt-4">4. Seus Direitos</h2>
                <p>Voc√™ tem controle sobre seus dados. Voc√™ pode editar seu apelido e configura√ß√µes ou apagar as datas
                    do seu calend√°rio a qualquer momento.</p>
            </main>
        </div>

        <!-- ======================== -->
        <!-- P√ÅGINA: TERMOS (Oculta)  -->
        <!-- ======================== -->
        <div id="page-termos" class="page-content hidden">
            <header class="mb-8">
                <!-- Bot√£o Voltar -->
                <button data-target="page-perfil"
                    class="subpage-trigger mb-4 inline-flex items-center text-violet-600 font-semibold hover:text-violet-800 transition-colors">
                    <i data-lucide="chevron-left" class="w-5 h-5 mr-1"></i>
                    Voltar ao Perfil
                </button>
                <h1 class="text-4xl sm:text-5xl font-bold text-violet-700 mb-4">Termos de Uso</h1>
            </header>
            <main class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg space-y-5 text-gray-700 leading-relaxed">
                <h2 class="text-xl font-bold text-gray-800">1. Aceita√ß√£o dos Termos</h2>
                <p>Ao usar este aplicativo, voc√™ concorda com estes termos. O objetivo deste app √© puramente educacional
                    e informativo.</p>

                <h2 class="text-xl font-bold text-gray-800 pt-4">2. Este App N√£o √© Aconselhamento M√©dico</h2>
                <p class="font-bold text-rose-600">As informa√ß√µes e previs√µes fornecidas neste aplicativo N√ÉO substituem
                    uma consulta com um profissional de sa√∫de (como seu enfermeiro(a) escolar ou ginecologista).</p>
                <p>O conte√∫do √© baseado em informa√ß√µes gerais e pode n√£o se aplicar perfeitamente ao seu corpo,
                    especialmente nos primeiros anos do ciclo, que pode ser muito irregular.</p>

                <h2 class="text-xl font-bold text-gray-800 pt-4">3. Previs√µes do Calend√°rio</h2>
                <p>As previs√µes do calend√°rio (menstrua√ß√£o e per√≠odo f√©rtil) s√£o <strong
                        class="text-violet-700">estimativas</strong> baseadas nos dados que voc√™ insere e na m√©dia dos
                    seus ciclos anteriores. Elas podem conter erros e n√£o devem, em hip√≥tese alguma, ser usadas como
                    m√©todo contraceptivo.</p>

                <h2 class="text-xl font-bold text-gray-800 pt-4">4. Uso Respons√°vel da Comunidade</h2>
                <p>A aba "Comunidade" √© um espa√ßo p√∫blico. Seja respeitosa com as outras usu√°rias. N√£o compartilhe
                    informa√ß√µes pessoais identific√°veis. Posts ofensivos ou inadequados podem ser removidos (requer
                    modera√ß√£o futura).</p>
            </main>
        </div>

        <!-- ======================= -->
        <!-- P√ÅGINA: AJUDA (Oculta)  -->
        <!-- ======================= -->
        <div id="page-ajuda" class="page-content hidden">
            <header class="mb-8">
                <!-- Bot√£o Voltar -->
                <button data-target="page-perfil"
                    class="subpage-trigger mb-4 inline-flex items-center text-violet-600 font-semibold hover:text-violet-800 transition-colors">
                    <i data-lucide="chevron-left" class="w-5 h-5 mr-1"></i>
                    Voltar ao Perfil
                </button>
                <h1 class="text-4xl sm:text-5xl font-bold text-violet-700 mb-4">Ajuda e Suporte</h1>
                <p class="text-lg text-gray-600">Perguntas Frequentes (FAQ)</p>
            </header>
            <main class="bg-white p-6 sm:p-8 rounded-2xl shadow-lg space-y-6">
                <!-- FAQ 1 -->
                <div>
                    <h3 class="text-xl font-bold text-violet-700 mb-2">P: Como eu marco os dias da minha menstrua√ß√£o?
                    </h3>
                    <p><strong>R:</strong> √â simples! V√° at√© a aba "Calend√°rio", clique no dia em que sua menstrua√ß√£o
                        come√ßou e continue clicando nos dias seguintes enquanto ela durar. O dia ficar√° marcado com a
                        cor rosa.</p>
                </div>

                <!-- FAQ 2 -->
                <div class="pt-4 border-t border-gray-100">
                    <h3 class="text-xl font-bold text-violet-700 mb-2">P: O calend√°rio est√° mostrando previs√µes
                        estranhas. O que eu fa√ßo?</h3>
                    <p><strong>R:</strong> As previs√µes dependem das informa√ß√µes que voc√™ coloca! V√° na aba "Perfil" e
                        ajuste as "Configura√ß√µes do Ciclo". O app tentar√° usar a m√©dia dos seus √∫ltimos ciclos
                        automaticamente, mas ter um valor padr√£o (ex: 28 dias) ajuda no come√ßo. Quanto mais voc√™ usar e
                        marcar os dias, mais inteligente o calend√°rio fica.</p>
                </div>

                <!-- FAQ 3 -->
                <div class="pt-4 border-t border-gray-100">
                    <h3 class="text-xl font-bold text-violet-700 mb-2">P: Meus dados sumiram! O que eu fa√ßo?</h3>
                    <p><strong>R:</strong> Seus dados est√£o salvos na nuvem anonimamente. Se voc√™ limpou os dados do
                        navegador, pode ter perdido seu ID an√¥nimo. No futuro, planejamos adicionar uma forma de
                        restaurar sua conta usando o "ID de Usu√°rio" que aparece no seu Perfil.</p>
                </div>

                <!-- FAQ 4 -->
                <div class="pt-4 border-t border-gray-100">
                    <h3 class="text-xl font-bold text-violet-700 mb-2">P: Posso usar o calend√°rio para saber quando n√£o
                        vou engravidar?</h3>
                    <p><strong class="text-rose-600">R: N√ÉO! NUNCA!</strong> Como diz o M√≥dulo 4, o corpo adolescente √©
                        muito irregular. As previs√µes deste app (incluindo o per√≠odo f√©rtil) s√£o apenas estimativas para
                        voc√™ se organizar e <strong class="underline">N√ÉO SERVEM</strong> como m√©todo contraceptivo.
                        Converse com um profissional de sa√∫de sobre isso.</p>
                </div>
            </main>
        </div>


    </div>

    <!-- ======================== -->
    <!-- NAVEGA√á√ÉO INFERIOR FIXA -->
    <!-- ======================== -->
    <nav
        class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-t-lg flex justify-around p-3 sm:p-4 z-50">
        <!-- Bot√£o In√≠cio (Ativo por padr√£o) -->
        <button data-target="page-inicio"
            class="nav-button flex flex-col items-center justify-center w-1/4 text-violet-600" aria-selected="true">
            <!-- √çcone Lucide -->
            <i data-lucide="home" class="nav-icon w-6 h-6 mb-1 text-violet-600"></i>
            <span class="nav-text text-xs sm:text-sm font-medium text-violet-600">In√≠cio</span>
        </button>

        <!-- Bot√£o Calend√°rio -->
        <button data-target="page-calendario"
            class="nav-button flex flex-col items-center justify-center w-1/4 text-gray-400" aria-selected="false">
            <!-- √çcone Lucide -->
            <i data-lucide="calendar" class="nav-icon w-6 h-6 mb-1 text-gray-400"></i>
            <span class="nav-text text-xs sm:text-sm font-medium text-gray-400">Calend√°rio</span>
        </button>

        <!-- Bot√£o Comunidade -->
        <button data-target="page-comunidade"
            class="nav-button flex flex-col items-center justify-center w-1/4 text-gray-400" aria-selected="false">
            <!-- √çcone Lucide -->
            <i data-lucide="users" class="nav-icon w-6 h-6 mb-1 text-gray-400"></i>
            <span class="nav-text text-xs sm:text-sm font-medium text-gray-400">Comunidade</span>
        </button>

        <!-- Bot√£o Perfil -->
        <button data-target="page-perfil"
            class="nav-button flex flex-col items-center justify-center w-1/4 text-gray-400" aria-selected="false">
            <!-- √çcone Lucide -->
            <i data-lucide="user" class="nav-icon w-6 h-6 mb-1 text-gray-400"></i>
            <span class="nav-text text-xs sm:text-sm font-medium text-gray-400">Perfil</span>
        </button>
    </nav>


    <!-- ================== -->
    <!-- SCRIPT GERAL (JS) -->
    <!-- ================== -->
    <!-- MUDAN√áA: O script agora √© type="module" para suportar importa√ß√µes -->
    <script type="module">
        // NOVO: Importa√ß√µes do Firebase (VERS√ÉO 12.5.0)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
        import {
            getFirestore, doc, getDoc, setDoc, addDoc, updateDoc, collection,
            query, onSnapshot, serverTimestamp, increment, setLogLevel, orderBy
        } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

        document.addEventListener('DOMContentLoaded', () => {

            // --- NOVO: Vari√°veis Globais do Firebase e Estado ---
            let app, db, auth;
            let currentUserId = null;
            let userNickname = 'Visitante';
            let cicloConfig = { cycleLength: 28, periodLength: 5 };
            let selectedDates = new Set();
            let communityPosts = []; // Cache local dos posts
            let unsubscribeFromPosts = null; // Listener da comunidade
            let unsubscribeFromReplies = null; // Listener das respostas
            let currentPostIdForReplies = null; // Para saber qual post estamos vendo

            // === ALTERA√á√ÉO PARA TESTE LOCAL ===
            // As vari√°veis __app_id e __firebase_config foram substitu√≠das
            // pela sua configura√ß√£o real do Firebase.
            const appId = 'site-cons-mestruacao'; // Usando seu Project ID
            const firebaseConfig = {
                apiKey: "AIzaSyANdpfR-R3fM6eqIOQJcx6yomQLpGqLNDA",
                authDomain: "site-cons-mestruacao.firebaseapp.com",
                projectId: "site-cons-mestruacao",
                storageBucket: "site-cons-mestruacao.firebasestorage.app",
                messagingSenderId: "758087720275",
                appId: "1:758087720275:web:07b63198f2a034346d15a6"
            };
            // === FIM DA ALTERA√á√ÉO ===


            // --- NOVO: Elementos do DOM ---
            const loadingOverlay = document.getElementById('loading-overlay');
            const nicknameInput = document.getElementById('nickname');
            const saveNicknameBtn = document.getElementById('save-nickname-btn');
            const nicknameFeedback = document.getElementById('save-nickname-feedback');

            const cycleLengthInput = document.getElementById('cycle-length');
            const periodLengthInput = document.getElementById('period-length');
            const saveConfigBtn = document.getElementById('save-config-btn');
            const configFeedback = document.getElementById('save-config-feedback');
            const avgCycleFeedback = document.getElementById('avg-cycle-feedback');
            const userIdDisplay = document.getElementById('user-id-display');

            const postTextarea = document.getElementById('post-textarea');
            const postTitleInput = document.getElementById('post-title-input');
            const postBtn = document.getElementById('post-btn');
            const feedWrapper = document.getElementById('community-feed-wrapper');
            const postDetailContent = document.getElementById('post-detail-content');
            const postRepliesList = document.getElementById('post-replies-list');
            const replyTextarea = document.getElementById('reply-textarea');
            const replyBtn = document.getElementById('reply-btn');

            const monthYearEl = document.getElementById('month-year');
            const gridEl = document.getElementById('calendar-grid');
            const prevBtn = document.getElementById('prev-month');
            const nextBtn = document.getElementById('next-month');

            // --- FUN√á√ïES HELPER ---
            function showFeedback(element, message) {
                if (element) {
                    element.textContent = message;
                    element.classList.remove('opacity-0');
                    setTimeout(() => {
                        element.classList.add('opacity-0');
                    }, 2000);
                }
            }

            function escapeHTML(str) {
                if (typeof str !== 'string') return '';
                return str.replace(/[&<>"']/g, (match) => ({
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#39;'
                }[match]));
            }

            // NOVO: Fun√ß√£o movida para o escopo global
            function updateAverageCycleFeedback() {
                if (!avgCycleFeedback) return;
                const calculatedAvg = getAverageCycleLength();
                if (calculatedAvg.average > 0) {
                    avgCycleFeedback.textContent = `A m√©dia calculada dos seus √∫ltimos ${calculatedAvg.count} ciclos √© de ${calculatedAvg.average} dias. O app usar√° esse valor.`;
                } else {
                    avgCycleFeedback.textContent = `Seu valor salvo (${cicloConfig.cycleLength} dias) ser√° usado at√© voc√™ ter mais ciclos registrados.`;
                }
            }

            // --- NOVO: L√ìGICA DE INICIALIZA√á√ÉO DO FIREBASE ---
            async function initializeFirebase() {
                if (!firebaseConfig) {
                    console.error("Configura√ß√£o do Firebase n√£o encontrada!");
                    loadingOverlay.innerHTML = "<p class='text-red-600 p-4 text-center'>Erro: Configura√ß√£o do Firebase n√£o encontrada. O app n√£o pode funcionar.</p>";
                    return;
                }

                try {
                    app = initializeApp(firebaseConfig);
                    db = getFirestore(app);
                    auth = getAuth(app);
                    setLogLevel('Debug'); // Ativa logs detalhados do Firestore

                    // Inicia o listener de autentica√ß√£o
                    onAuthStateChanged(auth, async (user) => {
                        if (user) {
                            // Usu√°rio est√° logado (anonimamente)
                            console.log('Usu√°rio autenticado:', user.uid);
                            currentUserId = user.uid;

                            // Atualiza o ID no perfil
                            if (userIdDisplay) {
                                userIdDisplay.value = currentUserId;
                            }

                            // Carrega os dados privados do usu√°rio
                            await loadUserData(currentUserId);

                            // Inicia o listener para posts da comunidade
                            listenForCommunityPosts();

                            // Esconde o loading
                            loadingOverlay.classList.add('opacity-0', 'pointer-events-none');
                        } else {
                            // Ningu√©m logado, tenta logar anonimamente
                            console.log('Nenhum usu√°rio, tentando login an√¥nimo...');
                            loadingOverlay.classList.remove('opacity-0', 'pointer-events-none');

                            try {
                                // === ALTERA√á√ÉO PARA TESTE LOCAL ===
                                // A vari√°vel __initial_auth_token n√£o existe localmente,
                                // ent√£o vamos direto para o signInAnonymously.
                                if (typeof __initial_auth_token !== 'undefined') {
                                    // Este bloco ser√° usado no Canvas
                                    await signInWithCustomToken(auth, __initial_auth_token);
                                } else {
                                    // Este bloco ser√° usado localmente
                                    await signInAnonymously(auth);
                                }
                                // === FIM DA ALTERA√á√ÉO ===
                            } catch (error) {
                                console.error('Erro ao fazer login an√¥nimo:', error);
                                loadingOverlay.innerHTML = "<p class='text-red-600 p-4 text-center'>Erro ao conectar. Por favor, atualize a p√°gina.</p>";
                            }
                        }
                    });

                } catch (error) {
                    console.error('Erro ao inicializar Firebase:', error);
                    loadingOverlay.innerHTML = "<p class='text-red-600 p-4 text-center'>Erro cr√≠tico ao inicializar o app.</p>";
                }
            }

            // --- NOVO: CARREGAR DADOS DO USU√ÅRIO (Firestore) ---
            async function loadUserData(userId) {
                if (!db) return;

                // Caminhos dos documentos
                const configDocRef = doc(db, `artifacts/${appId}/users/${userId}/profile/config`);
                const datesDocRef = doc(db, `artifacts/${appId}/users/${userId}/calendar/dates`);

                try {
                    // Carrega Configura√ß√µes
                    const configDoc = await getDoc(configDocRef);
                    if (configDoc.exists()) {
                        const data = configDoc.data();
                        cicloConfig = {
                            cycleLength: data.cycleLength || 28,
                            periodLength: data.periodLength || 5
                        };
                        userNickname = data.nickname || 'Visitante';
                    } else {
                        // Novo usu√°rio, salva os padr√µes
                        await setDoc(configDocRef, { ...cicloConfig, nickname: userNickname });
                    }

                    // Carrega Datas do Calend√°rio
                    const datesDoc = await getDoc(datesDocRef);
                    if (datesDoc.exists()) {
                        // Converte o array salvo de volta para um Set
                        selectedDates = new Set(datesDoc.data().dates || []);
                    } else {
                        // Novo usu√°rio, salva o Set vazio (como array)
                        await setDoc(datesDocRef, { dates: [] });
                    }

                    // Atualiza a UI com os dados carregados
                    updateProfileUI();

                } catch (error) {
                    console.error("Erro ao carregar dados do usu√°rio:", error);
                }
            }

            // --- NOVO: Fun√ß√µes de salvar dados (Firestore) ---
            async function saveProfileConfig() {
                if (!currentUserId || !db) return;
                const configDocRef = doc(db, `artifacts/${appId}/users/${currentUserId}/profile/config`);
                try {
                    await setDoc(configDocRef, {
                        nickname: userNickname,
                        cycleLength: cicloConfig.cycleLength,
                        periodLength: cicloConfig.periodLength
                    }, { merge: true }); // Merge para n√£o sobrescrever campos
                } catch (error) {
                    console.error("Erro ao salvar config do perfil:", error);
                }
            }

            async function saveCalendarDates() {
                if (!currentUserId || !db) return;
                const datesDocRef = doc(db, `artifacts/${appId}/users/${currentUserId}/calendar/dates`);
                try {
                    // Converte o Set para Array para salvar no Firestore
                    await setDoc(datesDocRef, { dates: Array.from(selectedDates) });
                } catch (error) {
                    console.error("Erro ao salvar datas do calend√°rio:", error);
                }
            }

            // --- L√ìGICA DE PERFIL (page-perfil) ---
            function updateProfileUI() {
                if (nicknameInput) nicknameInput.value = userNickname;
                if (cycleLengthInput) cycleLengthInput.value = cicloConfig.cycleLength;
                if (periodLengthInput) periodLengthInput.value = cicloConfig.periodLength;
                // Atualiza o feedback da m√©dia
                updateAverageCycleFeedback();
            }

            if (saveNicknameBtn) {
                saveNicknameBtn.addEventListener('click', async () => {
                    userNickname = nicknameInput.value.trim() || 'Visitante';
                    nicknameInput.value = userNickname;
                    await saveProfileConfig(); // Salva no Firestore
                    showFeedback(nicknameFeedback, 'Salvo!');
                });
            }

            if (saveConfigBtn) {
                saveConfigBtn.addEventListener('click', async () => {
                    cicloConfig.cycleLength = parseInt(cycleLengthInput.value) || 28;
                    cicloConfig.periodLength = parseInt(periodLengthInput.value) || 5;
                    await saveProfileConfig(); // Salva no Firestore
                    showFeedback(configFeedback, 'Salvo!');

                    // Re-renderizar o calend√°rio e feedback
                    if (window.renderCalendar) {
                        let currentDate = new Date();
                        window.renderCalendar(currentDate.getFullYear(), currentDate.getMonth());
                    }
                    updateAverageCycleFeedback();
                });
            }

            // --- L√ìGICA DA COMUNIDADE (page-comunidade) ---

            // Formata timestamp do Firebase (se existir)
            function formatFirebaseTimestamp(fbTimestamp) {
                if (!fbTimestamp) return 'um tempo atr√°s';
                const date = fbTimestamp.toDate(); // Converte para Date
                const now = new Date();
                const diffMs = now - date;
                const diffSec = Math.round(diffMs / 1000);
                const diffMin = Math.round(diffSec / 60);
                const diffHr = Math.round(diffMin / 60);
                const diffDay = Math.round(diffHr / 24);

                if (diffSec < 60) return `Agora mesmo`;
                if (diffMin < 60) return `${diffMin} min atr√°s`;
                if (diffHr < 24) return `${diffHr}h atr√°s`;
                return `${diffDay}d atr√°s`;
            }

            function createPostHTML(post, isDetailView = false) {
                const safeTitle = escapeHTML(post.title);
                const safeBody = escapeHTML(post.body).replace(/\n/g, '<br>');
                const replyCount = post.replyCount || 0;

                const cursorClass = isDetailView ? '' : 'cursor-pointer hover:bg-gray-50 post-item-trigger';
                // ATEN√á√ÉO: post.id agora √© o ID do Documento do Firestore
                const postIdAttr = isDetailView ? '' : `data-post-id="${post.id}"`;

                return `
                <div class="bg-white p-6 rounded-2xl shadow-lg transition-colors ${cursorClass}" ${postIdAttr}>
                    <div class="flex items-center space-x-3 mb-4">
                        <i data-lucide="user-circle-2" class="w-10 h-10 ${escapeHTML(post.avatarColor) || 'text-gray-500'}"></i>
                        <div>
                            <h3 class="font-bold text-gray-800">${escapeHTML(post.author)}</h3>
                            <p class="text-xs text-gray-500">Postado ${formatFirebaseTimestamp(post.timestamp)}</p>
                        </div>
                    </div>
                    <h4 class="text-xl font-semibold text-violet-700 mb-2">${safeTitle}</h4>
                    <p class="text-gray-600 mb-4 break-words">${safeBody}</p>
                    <div class="flex items-center text-sm text-gray-500">
                        <i data-lucide="message-circle" class="w-4 h-4 mr-1.5"></i>
                        ${replyCount} ${replyCount === 1 ? 'Resposta' : 'Respostas'}
                    </div>
                </div>
                `;
            }

            function createReplyHTML(reply) {
                const safeBody = escapeHTML(reply.body).replace(/\n/g, '<br>');
                return `
                <div class="bg-gray-50 p-5 rounded-2xl shadow-inner ml-4 sm:ml-8">
                    <div class="flex items-center space-x-3 mb-3">
                        <i data-lucide="user-circle" class="w-8 h-8 text-gray-500"></i>
                        <div>
                            <h4 class="font-bold text-gray-800">${escapeHTML(reply.author)}</h4>
                            <p class="text-xs text-gray-500">Respondido ${formatFirebaseTimestamp(reply.timestamp)}</p>
                        </div>
                    </div>
                    <p class="text-gray-700 break-words">${safeBody}</p>
                </div>
                `;
            }

            // NOVO: Listener de posts do Firestore
            function listenForCommunityPosts() {
                if (!db) return;
                // Desconecta listener antigo, se existir
                if (unsubscribeFromPosts) {
                    unsubscribeFromPosts();
                }

                const postsColRef = collection(db, `artifacts/${appId}/public/data/community_posts`);
                // Ordena pelos mais recentes
                const q = query(postsColRef, orderBy("timestamp", "desc"));

                unsubscribeFromPosts = onSnapshot(q, (querySnapshot) => {
                    communityPosts = []; // Limpa o cache local
                    querySnapshot.forEach((doc) => {
                        communityPosts.push({ id: doc.id, ...doc.data() });
                    });
                    // Re-renderiza o feed
                    renderCommunityPosts();
                }, (error) => {
                    console.error("Erro ao ouvir posts da comunidade:", error);
                });
            }

            function renderCommunityPosts() {
                if (!feedWrapper) return;

                const titleElement = feedWrapper.querySelector('h2');
                feedWrapper.innerHTML = '';
                if (titleElement) {
                    feedWrapper.appendChild(titleElement);
                }

                if (communityPosts.length === 0) {
                    const noPostsEl = document.createElement('p');
                    noPostsEl.className = 'text-gray-500 text-center';
                    noPostsEl.textContent = 'Ainda n√£o h√° posts. Seja a primeira a compartilhar!';
                    feedWrapper.appendChild(noPostsEl);
                } else {
                    communityPosts.forEach(post => {
                        feedWrapper.insertAdjacentHTML('beforeend', createPostHTML(post, false));
                    });
                }
                if (window.lucide) {
                    lucide.createIcons();
                }
            }

            // Postar (agora no Firestore)
            if (postBtn) {
                postBtn.addEventListener('click', async () => {
                    if (!currentUserId || !db) return;

                    const title = postTitleInput.value.trim();
                    const text = postTextarea.value.trim();
                    if (text && title) {
                        const postsColRef = collection(db, `artifacts/${appId}/public/data/community_posts`);
                        try {
                            // Desativa o bot√£o para evitar cliques duplos
                            postBtn.disabled = true;
                            postBtn.textContent = "Postando...";

                            await addDoc(postsColRef, {
                                author: userNickname,
                                avatarColor: 'text-violet-500', // Padr√£o para posts de usu√°rio
                                title: title,
                                body: text,
                                timestamp: serverTimestamp(), // Usa o timestamp do servidor
                                userId: currentUserId, // Salva o ID do autor
                                replyCount: 0 // Inicia contagem de respostas
                            });

                            // Limpa os campos
                            postTextarea.value = '';
                            postTitleInput.value = '';
                            // O listener onSnapshot vai cuidar de re-renderizar

                        } catch (error) {
                            console.error("Erro ao criar post:", error);
                        } finally {
                            // Re-ativa o bot√£o
                            postBtn.disabled = false;
                            postBtn.innerHTML = '<i data-lucide="send" class="w-5 h-5 mr-2"></i> Postar';
                            lucide.createIcons();
                        }
                    }
                });
            }

            // Renderiza a p√°gina de detalhe do post (lendo do Firestore)
            async function renderPostDetail(postId) {
                if (!db || !postDetailContent || !postRepliesList || !replyBtn) return;

                // Salva o ID do post atual
                currentPostIdForReplies = postId;

                // 1. Renderiza o post principal (busca √∫nica)
                const postDocRef = doc(db, `artifacts/${appId}/public/data/community_posts`, postId);
                try {
                    const postDoc = await getDoc(postDocRef);
                    if (postDoc.exists()) {
                        const postData = { id: postDoc.id, ...postDoc.data() };
                        postDetailContent.innerHTML = createPostHTML(postData, true); // true = isDetailView
                    } else {
                        postDetailContent.innerHTML = "<p>Post n√£o encontrado.</p>";
                    }
                } catch (error) {
                    console.error("Erro ao buscar post:", error);
                    postDetailContent.innerHTML = "<p>Erro ao carregar post.</p>";
                }


                // 2. Inicia o listener para as respostas
                // Desconecta listener antigo
                if (unsubscribeFromReplies) {
                    unsubscribeFromReplies();
                }
                const repliesColRef = collection(db, `artifacts/${appId}/public/data/community_posts/${postId}/replies`);
                const q = query(repliesColRef, orderBy("timestamp", "asc")); // Mais antigas primeiro

                unsubscribeFromReplies = onSnapshot(q, (querySnapshot) => {
                    postRepliesList.innerHTML = ''; // Limpa respostas antigas
                    if (querySnapshot.empty) {
                        postRepliesList.innerHTML = '<p class="text-gray-500 text-center italic">Nenhuma resposta ainda.</p>';
                    } else {
                        querySnapshot.forEach((doc) => {
                            postRepliesList.insertAdjacentHTML('beforeend', createReplyHTML(doc.data()));
                        });
                    }
                    lucide.createIcons();
                }, (error) => {
                    console.error("Erro ao ouvir respostas:", error);
                });

                // 3. Atribui o ID do post ao bot√£o de responder
                replyBtn.dataset.currentPostId = postId;

                // 4. Limpa o textarea
                if (replyTextarea) replyTextarea.value = '';

                // 5. Recria √≠cones
                if (window.lucide) {
                    lucide.createIcons();
                }
            }

            // Adiciona listener de clique para responder (no Firestore)
            if (replyBtn) {
                replyBtn.addEventListener('click', async () => {
                    const text = replyTextarea.value.trim();
                    const postId = replyBtn.dataset.currentPostId;

                    if (text && postId && currentUserId && db) {
                        // Caminho para a subcole√ß√£o de respostas
                        const repliesColRef = collection(db, `artifacts/${appId}/public/data/community_posts/${postId}/replies`);
                        // Caminho para o documento do post principal
                        const postDocRef = doc(db, `artifacts/${appId}/public/data/community_posts`, postId);

                        try {
                            replyBtn.disabled = true;
                            replyBtn.textContent = "Respondendo...";

                            // 1. Adiciona a nova resposta
                            await addDoc(repliesColRef, {
                                author: userNickname,
                                body: text,
                                timestamp: serverTimestamp(),
                                userId: currentUserId
                            });

                            // 2. Atualiza (incrementa) a contagem no post principal
                            await updateDoc(postDocRef, {
                                replyCount: increment(1)
                            });

                            // Limpa o textarea
                            replyTextarea.value = '';
                            // O listener onSnapshot vai cuidar de mostrar a nova resposta

                        } catch (error) {
                            console.error("Erro ao postar resposta:", error);
                        } finally {
                            replyBtn.disabled = false;
                            replyBtn.innerHTML = '<i data-lucide="send" class="w-5 h-5 mr-2"></i> Responder';
                            lucide.createIcons();
                        }
                    }
                });
            }

            // Listener de clique no feed (Event Delegation)
            if (feedWrapper) {
                feedWrapper.addEventListener('click', (e) => {
                    const postTrigger = e.target.closest('.post-item-trigger');
                    if (postTrigger) {
                        const postId = postTrigger.dataset.postId;
                        if (postId) {
                            // Chama a fun√ß√£o que l√™ do Firestore
                            renderPostDetail(postId);
                            showPage('page-post-detail');
                        }
                    }
                });
            }


            // --- L√ìGICA DO CALEND√ÅRIO (page-calendario) ---
            let currentDateForCalendar = new Date();

            if (monthYearEl && gridEl && prevBtn && nextBtn) {
                const monthNames = ["Janeiro", "Fevereiro", "Mar√ßo", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];

                function addDays(date, days) {
                    const result = new Date(date);
                    result.setDate(result.getDate() + days);
                    return result;
                }

                function formatDate(date) {
                    return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
                }

                function getCycleStartDates() {
                    if (selectedDates.size === 0) return [];
                    const sortedDates = Array.from(selectedDates).sort((a, b) => new Date(a) - new Date(b));
                    let cyclesStartDates = [];
                    if (sortedDates.length > 0) {
                        cyclesStartDates.push(new Date(sortedDates[0]));
                        for (let i = 1; i < sortedDates.length; i++) {
                            let prevDate = new Date(sortedDates[i - 1]);
                            let currDate = new Date(sortedDates[i]);
                            let diffTime = currDate.getTime() - prevDate.getTime();
                            let diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                            if (diffDays > 15) {
                                cyclesStartDates.push(currDate);
                            }
                        }
                    }
                    return cyclesStartDates;
                }

                function getAverageCycleLength() {
                    const cyclesStartDates = getCycleStartDates();
                    if (cyclesStartDates.length < 2) {
                        return { average: 0, count: 0 };
                    }
                    let cycleLengths = [];
                    for (let i = 1; i < cyclesStartDates.length; i++) {
                        let prevCycle = cyclesStartDates[i - 1];
                        let currCycle = cyclesStartDates[i];
                        let diffTime = currCycle.getTime() - prevCycle.getTime();
                        let diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        cycleLengths.push(diffDays);
                    }
                    if (cycleLengths.length === 0) {
                        return { average: 0, count: 0 };
                    }
                    const lastThreeLengths = cycleLengths.slice(-3);
                    const sum = lastThreeLengths.reduce((a, b) => a + b, 0);
                    const average = Math.round(sum / lastThreeLengths.length);
                    return { average: average, count: lastThreeLengths.length };
                }

                // REMOVIDO: A fun√ß√£o foi movida para o escopo global
                /*
                function updateAverageCycleFeedback() {
                    if (!avgCycleFeedback) return;
                    const calculatedAvg = getAverageCycleLength();
                    if (calculatedAvg.average > 0) {
                        avgCycleFeedback.textContent = `A m√©dia calculada dos seus √∫ltimos ${calculatedAvg.count} ciclos √© de ${calculatedAvg.average} dias. O app usar√° esse valor.`;
                    } else {
                        avgCycleFeedback.textContent = `Seu valor salvo (${cicloConfig.cycleLength} dias) ser√° usado at√© voc√™ ter mais ciclos registrados.`;
                    }
                }
                */

                function getPredictions() {
                    const cyclesStartDates = getCycleStartDates();
                    if (cyclesStartDates.length === 0) {
                        return { nextPeriod: [], fertileWindow: [] };
                    }
                    const lastCycleStartDate = cyclesStartDates[cyclesStartDates.length - 1];
                    const { periodLength } = cicloConfig;
                    const calculatedAvg = getAverageCycleLength();
                    let effectiveCycleLength;

                    if (calculatedAvg.average > 0) {
                        effectiveCycleLength = calculatedAvg.average;
                    } else {
                        effectiveCycleLength = cicloConfig.cycleLength; // Fallback
                    }

                    // 1. Previs√£o da Pr√≥xima Menstrua√ß√£o
                    const nextPeriodStartDate = addDays(lastCycleStartDate, effectiveCycleLength);
                    const predictions = {
                        nextPeriod: [],
                        fertileWindow: []
                    };
                    for (let i = 0; i < periodLength; i++) {
                        predictions.nextPeriod.push(formatDate(addDays(nextPeriodStartDate, i)));
                    }

                    // 2. Previs√£o do Per√≠odo F√©rtil
                    const estimatedOvulationDate = addDays(nextPeriodStartDate, -14);
                    for (let i = -5; i <= 0; i++) {
                        predictions.fertileWindow.push(formatDate(addDays(estimatedOvulationDate, i)));
                    }
                    return predictions;
                }

                // Tornar a fun√ß√£o de renderiza√ß√£o global
                window.renderCalendar = function (year, month) {
                    if (!gridEl || !monthYearEl) return;
                    gridEl.innerHTML = '';
                    monthYearEl.textContent = `${monthNames[month]} ${year}`;
                    const predictions = getPredictions();
                    let firstDayOfWeek = new Date(year, month, 1).getDay();
                    let totalDaysInMonth = new Date(year, month + 1, 0).getDate();
                    for (let i = 0; i < firstDayOfWeek; i++) {
                        gridEl.appendChild(document.createElement('div'));
                    }
                    let today = new Date();
                    for (let day = 1; day <= totalDaysInMonth; day++) {
                        const dayEl = document.createElement('div');
                        const dateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                        dayEl.textContent = day;
                        dayEl.className = 'h-10 w-10 flex items-center justify-center rounded-full cursor-pointer hover:bg-violet-100 transition-colors duration-150';
                        const isToday = day === today.getDate() && month === today.getMonth() && year === today.getFullYear();
                        if (isToday) {
                            dayEl.classList.add('bg-violet-100', 'text-violet-700', 'font-bold');
                        }
                        if (selectedDates.has(dateString)) {
                            dayEl.className = 'h-10 w-10 flex items-center justify-center rounded-full cursor-pointer bg-rose-300 text-rose-800 font-bold';
                        } else if (predictions.nextPeriod.includes(dateString)) {
                            dayEl.className = 'h-10 w-10 flex items-center justify-center rounded-full cursor-pointer bg-rose-100 text-rose-500 border border-rose-200';
                            dayEl.style.backgroundImage = 'linear-gradient(135deg, rgba(255,255,255,0.5) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.5) 50%, rgba(255,255,255,0.5) 75%, transparent 75%, transparent)';
                            dayEl.style.backgroundSize = '8px 8px';
                        } else if (predictions.fertileWindow.includes(dateString)) {
                            dayEl.className = 'h-10 w-10 flex items-center justify-center rounded-full cursor-pointer bg-emerald-100 text-emerald-700 border border-emerald-200';
                        }

                        dayEl.addEventListener('click', () => {
                            if (selectedDates.has(dateString)) {
                                selectedDates.delete(dateString);
                            } else {
                                selectedDates.add(dateString);
                            }
                            // Salva no Firestore
                            saveCalendarDates();
                            // Re-renderiza o calend√°rio para atualizar cores E previs√µes
                            window.renderCalendar(year, month);
                            // Atualiza o feedback de m√©dia no perfil
                            updateAverageCycleFeedback();
                        });
                        gridEl.appendChild(dayEl);
                    }
                }

                prevBtn.addEventListener('click', () => {
                    currentDateForCalendar.setMonth(currentDateForCalendar.getMonth() - 1);
                    window.renderCalendar(currentDateForCalendar.getFullYear(), currentDateForCalendar.getMonth());
                });

                nextBtn.addEventListener('click', () => {
                    currentDateForCalendar.setMonth(currentDateForCalendar.getMonth() + 1);
                    window.renderCalendar(currentDateForCalendar.getFullYear(), currentDateForCalendar.getMonth());
                });
            }


            // --- L√ìGICA DE NAVEGA√á√ÉO GERAL ---
            const navButtons = document.querySelectorAll('.nav-button');
            const subpageTriggers = document.querySelectorAll('.subpage-trigger');
            const pages = document.querySelectorAll('.page-content');

            function showPage(targetPageId) {
                // NOVO: Desconecta o listener de respostas se sairmos da p√°gina de detalhes
                if (targetPageId !== 'page-post-detail' && unsubscribeFromReplies) {
                    console.log("Saindo do post, desconectando listener de respostas.");
                    unsubscribeFromReplies();
                    unsubscribeFromReplies = null;
                    currentPostIdForReplies = null;
                }

                pages.forEach(page => page.classList.add('hidden'));
                const targetPage = document.getElementById(targetPageId);
                if (targetPage) {
                    targetPage.classList.remove('hidden');
                }
                navButtons.forEach(btn => {
                    const icon = btn.querySelector('.nav-icon');
                    const text = btn.querySelector('.nav-text');
                    const isTarget = btn.dataset.target === targetPageId;
                    btn.setAttribute('aria-selected', isTarget ? 'true' : 'false');
                    btn.classList.toggle('text-violet-600', isTarget);
                    btn.classList.toggle('text-gray-400', !isTarget);
                    if (icon) {
                        icon.classList.toggle('text-violet-600', isTarget);
                        icon.classList.toggle('text-gray-400', !isTarget);
                    }
                    if (text) {
                        text.classList.toggle('text-violet-600', isTarget);
                        text.classList.toggle('text-gray-400', !isTarget);
                    }
                });

                // ATUALIZA√á√ïES DIN√ÇMICAS AO TROCAR DE ABA
                // (Os listeners do Firebase cuidam da comunidade)
                if (targetPageId === 'page-calendario' && window.renderCalendar) {
                    currentDateForCalendar = new Date();
                    window.renderCalendar(currentDateForCalendar.getFullYear(), currentDateForCalendar.getMonth());
                }
                if (targetPageId === 'page-perfil') {
                    updateProfileUI();
                }
                window.scrollTo(0, 0);
            }

            navButtons.forEach(button => {
                button.addEventListener('click', () => {
                    showPage(button.dataset.target);
                });
            });

            subpageTriggers.forEach(button => {
                button.addEventListener('click', () => {
                    showPage(button.dataset.target);
                });
            });


            // --- L√ìGICA DO ACORDE√ÉO (page-inicio) ---
            const toggles = document.querySelectorAll('.module-toggle');
            toggles.forEach(toggle => {
                toggle.addEventListener('click', () => {
                    const content = document.getElementById(toggle.getAttribute('aria-controls'));
                    const icon = toggle.querySelector('.toggle-icon');
                    if (content) {
                        const isHidden = content.classList.toggle('hidden');
                        toggle.setAttribute('aria-expanded', isHidden ? 'false' : 'true');
                        toggle.classList.toggle('rounded-b-2xl', isHidden);
                        icon.textContent = isHidden ? 'Ôºã' : 'Ôºç';
                    }
                });
            });

            // --- INICIALIZA LUCIDE ICONS ---
            if (window.lucide) {
                lucide.createIcons();
            }

            // --- NOVO: INICIA A APLICA√á√ÉO FIREBASE ---
            initializeFirebase();
        });
    </script>

</body>

</html>